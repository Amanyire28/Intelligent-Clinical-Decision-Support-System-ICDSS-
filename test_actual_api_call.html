<!DOCTYPE html>
<html>
<head>
    <title>Direct Test - Mimic Actual Request</title>
</head>
<body>
    <h1>Test Assessment API - Same as patient_assessment.php</h1>
    <button onclick="testAPI()">Click to Test API</button>
    <div id="result" style="border: 1px solid #ccc; padding: 10px; margin-top: 20px; min-height: 100px; background-color: #f5f5f5;"></div>
    
    <script>
    async function testAPI() {
        document.getElementById('result').innerHTML = 'Loading...';
        
        try {
            console.log('Fetching from: /CANCER/index.php?page=api-patient-assessments');
            const response = await fetch('/CANCER/index.php?page=api-patient-assessments', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded'
                },
                body: 'patient_id=3'
            });
            
            console.log('Response status:', response.status);
            console.log('Response type:', response.type);
            console.log('Response URL:', response.url);
            console.log('Response headers Content-Type:', response.headers.get('Content-Type'));
            
            const text = await response.text();
            console.log('Response text (first 500 chars):', text.substring(0, 500));
            
            // Try to parse as JSON
            try {
                const json = JSON.parse(text);
                document.getElementById('result').innerHTML = '<pre>SUCCESS!\n\n' + JSON.stringify(json, null, 2) + '</pre>';
            } catch (parseError) {
                document.getElementById('result').innerHTML = '<pre style="color: red;">ERROR parsing JSON: ' + parseError.message + '\n\nResponse (first 1000 chars):\n' + escapeHtml(text.substring(0, 1000)) + '</pre>';
            }
        } catch (error) {
            console.error('Fetch error:', error);
            document.getElementById('result').innerHTML = '<pre style="color: red;">FETCH ERROR: ' + error.message + '</pre>';
        }
    }
    
    function escapeHtml(text) {
        const map = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#039;'
        };
        return text.replace(/[&<>"']/g, m => map[m]);
    }
    
    // Auto-test on load (for debugging)
    window.addEventListener('load', function() {
        console.log('Page loaded, ready to test');
    });
    </script>
</body>
</html>
